# Ubuntu-Mini-Respin


Setting up keyboard-configuration (1.108ubuntu15) ...
Have to click OK twice

Setting up grub-pc (2.02~beta2-36ubuntu3) ...
Select /dev/sda click OK

DEBIAN_FRONTEND=noninteractive apt-get install keyboard-configuration
This is simple to automate, you just need to set the proper debconf configuration for this package.

First install debconf-utils:

sudo apt install debconf-utils
If you've already configured the package, you can read the debconf configuration with:

debconf-get-selections | grep keyboard-configuration
If you haven't configured the package or would like to change your selections, you can do this with:

dpkg-reconfigure keyboard-configuration
Export your selections to a file

debconf-get-selections | grep keyboard-configuration > selections.conf
Copy selections.conf to the target machine and set the selections:

debconf-set-selections < selections.conf
When you install or reconfigure the package, your choices will now be selected automatically.

dpkg-reconfigure keyboard-configuration -f noninteractive


Add less?

Should we remove all pyc files?
Should we apt-get remove --purge ubquity (and others) to remove config?
How do we create the installer?

cp chroot/boot/vmlinuz-2.6.**-**-generic image/casper/vmlinuz FAILED replaced with: sudo apt-get install linux-generic then sudo cp /boot/vmlinuz-2.6.31-10-generic chroot/boot sudo cp /boot/initrd.img-2.6.31-10-generic chroot/boot



This is an attempt to recreate Minibuntu/Ubuntu Mini Remix.
https://fabrizioballiano.net/ubuntu-mini-remix/

The script creates an Ubuntu ISO with as few dependencies as possible to be used as a base for respins.

## How Close Is It To Ubuntu Mini Remix?

Not close enough! _This is a work in progress to reduce the differences._

The process to create the Ubuntu Mini Remix doesn't appear to have be documented or is just no longer available.

See [here](https://answers.launchpad.net/ubuntu-mini-remix/+faq/33) for packages bundled in Ubuntu Mini Remix

> Ubuntu Mini Remix contains:
> - ubuntu-minimal (this is a metapackage, details at [http://tinyurl.com/2cpw6o])
> - ubuntu-standard (this is a metapackage, details at [http://tinyurl.com/323nu8])
> - casper
> - lupin-casper

The last published version of Ubuntu Mini Remix was based on 16.04 (xenial) so the first step is to try to reproduce the filesystem as closely as possible.

The following will list the contents of the filesystem on iso.
We exclude the dates to make the comparison easier.

    sudo mkdir /mnt/remix
    sudo mount -o loop ubuntu-mini-remix-16.04-amd64.iso /mnt/remix 
    sudo unsquashfs -d remix-squashfs /mnt/remix/casper/filesystem.squashfs
    cd remix-squashfs
    sudo find -printf "%P \t %u \t %g %m (%M) \t %k \n" > ../xenial-remix.txt
    sudo umount /mnt/remix
    cd ..
    sudo rm -rf remix-squashfs

Similarly, the following will list the contents of the filesystem generated by this project.
We can then diff the two to see how close it is to the original.

    cd build/xenial
    sudo find -printf "%P \t %u \t %g %m (%M) \t %k \n" | sed "s/$(whoami)/root/g"> ../../xenial-respin.txt

These outputs are checked in to make it easy to see what the differences are without requiring a build.

## Instructions

Since you are likely to want to run this multiple times, the script makes use of `squid` as a proxy to cache the deb files and the repository Release files. 
This is more reliable for offline work than `apt-cacherng` as squid can cache more than just the deb files.

The squid config is copied from `squid-deb-proxy` and has been modified slightly to run local to the project (instead of saving the cache/logs in the system dirs) and has been tweaked to work completely offline.

**Install squid**

    sudo apt install squid

**Start squid with the local config**

    ./caching-proxy.sh

**Run the main script**

    ./ubuntu-mini-respin.sh
 
## Tip and Guides

See here for tips on reducing debian size

https://wiki.debian.org/ReduceDebian


Guides on customising the Ubuntu LiveCD 

* https://help.ubuntu.com/community/LiveCDCustomization
* https://nathanpfry.com/how-to-customize-an-ubuntu-installation-disc/

Another script wrapping the above guide

https://pastebin.com/NQUTWC1y
